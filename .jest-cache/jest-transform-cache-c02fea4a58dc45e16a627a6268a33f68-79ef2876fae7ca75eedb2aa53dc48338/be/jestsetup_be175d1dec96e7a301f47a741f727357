c8637dcd366014081ec6a7c12c8ef592
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external services by default
jest.mock('nodemailer', () => ({
    createTransport: jest.fn(() => ({
        sendMail: jest.fn().mockResolvedValue({ messageId: 'test-message-id' }),
        verify: jest.fn().mockResolvedValue(true),
    })),
}));
jest.mock('@aws-sdk/client-s3', () => ({
    S3Client: jest.fn(() => ({
        send: jest.fn(),
    })),
    PutObjectCommand: jest.fn(),
    GetObjectCommand: jest.fn(),
    DeleteObjectCommand: jest.fn(),
    HeadObjectCommand: jest.fn(),
}));
jest.mock('@aws-sdk/client-cloudfront', () => ({
    CloudFrontClient: jest.fn(() => ({
        send: jest.fn(),
    })),
    CreateInvalidationCommand: jest.fn(),
    GetDistributionCommand: jest.fn(),
}));
jest.mock('stripe', () => ({
    __esModule: true,
    default: jest.fn(() => ({
        customers: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        paymentIntents: {
            create: jest.fn(),
            retrieve: jest.fn(),
            confirm: jest.fn(),
            cancel: jest.fn(),
        },
        subscriptions: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        webhooks: {
            constructEvent: jest.fn(),
        },
    })),
}));
require("reflect-metadata");
const dotenv_1 = require("dotenv");
// Load test environment variables
(0, dotenv_1.config)({ path: '.env.test' });
// Global test configuration
global.console = {
    ...console,
    // Suppress console.log in tests unless explicitly needed
    log: process.env.JEST_VERBOSE === 'true' ? console.log : jest.fn(),
    debug: process.env.JEST_VERBOSE === 'true' ? console.debug : jest.fn(),
    info: process.env.JEST_VERBOSE === 'true' ? console.info : jest.fn(),
    warn: console.warn,
    error: console.error,
};
// Global test timeout
jest.setTimeout(30000);
// Global test database connection
let testDataSource;
// Setup and teardown hooks
beforeAll(async () => {
    // Initialize test database connection if needed
    if (process.env.DATABASE_URL) {
        // Database setup would go here
    }
});
afterAll(async () => {
    // Cleanup test database connection
    if (testDataSource && testDataSource.isInitialized) {
        await testDataSource.destroy();
    }
});
beforeEach(() => {
    // Clear all mocks before each test
    jest.clearAllMocks();
});
afterEach(() => {
    // Additional cleanup after each test
    jest.restoreAllMocks();
});
// Export test utilities
global.testUtils = {
    createTestingModule: async (metadata) => {
        const { Test } = await Promise.resolve().then(() => __importStar(require('@nestjs/testing')));
        return Test.createTestingModule(metadata).compile();
    },
    createMockRepository: () => ({
        find: jest.fn(),
        findOne: jest.fn(),
        findOneBy: jest.fn(),
        findAndCount: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        remove: jest.fn(),
        count: jest.fn(),
        increment: jest.fn(),
        decrement: jest.fn(),
        createQueryBuilder: jest.fn(() => ({
            where: jest.fn().mockReturnThis(),
            andWhere: jest.fn().mockReturnThis(),
            orWhere: jest.fn().mockReturnThis(),
            orderBy: jest.fn().mockReturnThis(),
            limit: jest.fn().mockReturnThis(),
            offset: jest.fn().mockReturnThis(),
            skip: jest.fn().mockReturnThis(),
            take: jest.fn().mockReturnThis(),
            leftJoin: jest.fn().mockReturnThis(),
            leftJoinAndSelect: jest.fn().mockReturnThis(),
            innerJoin: jest.fn().mockReturnThis(),
            innerJoinAndSelect: jest.fn().mockReturnThis(),
            select: jest.fn().mockReturnThis(),
            addSelect: jest.fn().mockReturnThis(),
            groupBy: jest.fn().mockReturnThis(),
            having: jest.fn().mockReturnThis(),
            getOne: jest.fn(),
            getMany: jest.fn(),
            getManyAndCount: jest.fn(),
            getCount: jest.fn(),
            getRawOne: jest.fn(),
            getRawMany: jest.fn(),
            execute: jest.fn(),
        })),
    }),
    createMockService: (methods) => {
        const mockService = {};
        methods.forEach(method => {
            mockService[method] = jest.fn();
        });
        return mockService;
    },
    generateTestData: (type, overrides = {}) => {
        // This will be implemented with factories
        return { ...overrides };
    },
    cleanupDatabase: async () => {
        // Database cleanup implementation
        if (testDataSource && testDataSource.isInitialized) {
            // Clean up test data
        }
    },
};
// Environment validation
if (!process.env.NODE_ENV) {
    process.env.NODE_ENV = 'test';
}
if (process.env.NODE_ENV !== 'test') {
    throw new Error('Tests must be run with NODE_ENV=test');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiL1VzZXJzL21hY2Jvb2twcm8vU3RyZWxsZXJNaW5kcy1CYWNrZW5kL3Rlc3Qvc2V0dXAvamVzdC5zZXR1cC50cyIsIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQXNCQSxvQ0FBb0M7QUFDcEMsSUFBSSxDQUFDLElBQUksQ0FBQyxZQUFZLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM3QixlQUFlLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQzlCLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsRUFBRSxTQUFTLEVBQUUsaUJBQWlCLEVBQUUsQ0FBQztRQUN2RSxNQUFNLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRSxDQUFDLGlCQUFpQixDQUFDLElBQUksQ0FBQztLQUMxQyxDQUFDLENBQUM7Q0FDSixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsb0JBQW9CLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUNyQyxRQUFRLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ3ZCLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0tBQ2hCLENBQUMsQ0FBQztJQUNILGdCQUFnQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDM0IsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUMzQixtQkFBbUIsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzlCLGlCQUFpQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7Q0FDN0IsQ0FBQyxDQUFDLENBQUM7QUFFSixJQUFJLENBQUMsSUFBSSxDQUFDLDRCQUE0QixFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7SUFDN0MsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsQ0FBQyxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9CLElBQUksRUFBRSxJ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c0MsQ0FBQyxDQUFDO0FBQzFELENBQUMiLCJuYW1lcyI6W10sInNvdXJjZXMiOlsiL1VzZXJzL21hY2Jvb2twcm8vU3RyZWxsZXJNaW5kcy1CYWNrZW5kL3Rlc3Qvc2V0dXAvamVzdC5zZXR1cC50cyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgJ3JlZmxlY3QtbWV0YWRhdGEnO1xuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnZG90ZW52JztcbmltcG9ydCB7IERhdGFTb3VyY2UgfSBmcm9tICd0eXBlb3JtJztcbmltcG9ydCB7IFRlc3RpbmdNb2R1bGUgfSBmcm9tICdAbmVzdGpzL3Rlc3RpbmcnO1xuXG4vLyBMb2FkIHRlc3QgZW52aXJvbm1lbnQgdmFyaWFibGVzXG5jb25maWcoeyBwYXRoOiAnLmVudi50ZXN0JyB9KTtcblxuLy8gR2xvYmFsIHRlc3QgY29uZmlndXJhdGlvblxuZ2xvYmFsLmNvbnNvbGUgPSB7XG4gIC4uLmNvbnNvbGUsXG4gIC8vIFN1cHByZXNzIGNvbnNvbGUubG9nIGluIHRlc3RzIHVubGVzcyBleHBsaWNpdGx5IG5lZWRlZFxuICBsb2c6IHByb2Nlc3MuZW52LkpFU1RfVkVSQk9TRSA9PT0gJ3RydWUnID8gY29uc29sZS5sb2cgOiBqZXN0LmZuKCksXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5KRVNUX1ZFUkJPU0UgPT09ICd0cnVlJyA/IGNvbnNvbGUuZGVidWcgOiBqZXN0LmZuKCksXG4gIGluZm86IHByb2Nlc3MuZW52LkpFU1RfVkVSQk9TRSA9PT0gJ3RydWUnID8gY29uc29sZS5pbmZvIDogamVzdC5mbigpLFxuICB3YXJuOiBjb25zb2xlLndhcm4sXG4gIGVycm9yOiBjb25zb2xlLmVycm9yLFxufTtcblxuLy8gR2xvYmFsIHRlc3QgdGltZW91dFxuamVzdC5zZXRUaW1lb3V0KDMwMDAwKTtcblxuLy8gTW9jayBleHRlcm5hbCBzZXJ2aWNlcyBieSBkZWZhdWx0XG5qZXN0Lm1vY2soJ25vZGVtYWlsZXInLCAoKSA9PiAoe1xuICBjcmVhdGVUcmFuc3BvcnQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBzZW5kTWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgbWVzc2FnZUlkOiAndGVzdC1tZXNzYWdlLWlkJyB9KSxcbiAgICB2ZXJpZnk6IGplc3QuZm4oKS5tb2NrUmVzb2x2ZWRWYWx1ZSh0cnVlKSxcbiAgfSkpLFxufSkpO1xuXG5qZXN0Lm1vY2soJ0Bhd3Mtc2RrL2NsaWVudC1zMycsICgpID0+ICh7XG4gIFMzQ2xpZW50OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgc2VuZDogamVzdC5mbigpLFxuICB9KSksXG4gIFB1dE9iamVjdENvbW1hbmQ6IGplc3QuZm4oKSxcbiAgR2V0T2JqZWN0Q29tbWFuZDogamVzdC5mbigpLFxuICBEZWxldGVPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXG4gIEhlYWRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXG59KSk7XG5cbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LWNsb3VkZnJvbnQnLCAoKSA9PiAoe1xuICBDbG91ZEZyb250Q2xpZW50OiBqZXN0LmZuKCgpID0+ICh7XG4gICAgc2VuZDogamVzdC5mbigpLFxuICB9KSksXG4gIENyZWF0ZUludmFsaWRhdGlvbkNvbW1hbmQ6IGplc3QuZm4oKSxcbiAgR2V0RGlzdHJpYnV0aW9uQ29tbWFuZDogamVzdC5mbigpLFxufSkpO1xuXG5qZXN0Lm1vY2soJ3N0cmlwZScsICgpID0+ICh7XG4gIF9fZXNNb2R1bGU6IHRydWUsXG4gIGRlZmF1bHQ6IGplc3QuZm4oKCkgPT4gKHtcbiAgICBjdXN0b21lcnM6IHtcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgICAgcmV0cmlldmU6IGplc3QuZm4oKSxcbiAgICAgIHVwZGF0ZTogamVzdC5mbigpLFxuICAgICAgZGVsOiBqZXN0LmZuKCksXG4gICAgfSxcbiAgICBwYXltZW50SW50ZW50czoge1xuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXG4gICAgICByZXRyaWV2ZTogamVzdC5mbigpLFxuICAgICAgY29uZmlybTogamVzdC5mbigpLFxuICAgICAgY2FuY2VsOiBqZXN0LmZuKCksXG4gICAgfSxcbiAgICBzdWJzY3JpcHRpb25zOiB7XG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcbiAgICAgIHJldHJpZXZlOiBqZXN0LmZuKCksXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICAgIGRlbDogamVzdC5mbigpLFxuICAgIH0sXG4gICAgd2ViaG9va3M6IHtcbiAgICAgIGNvbnN0cnVjdEV2ZW50OiBqZXN0LmZuKCksXG4gICAgfSxcbiAgfSkpLFxufSkpO1xuXG4vLyBHbG9iYWwgdGVzdCBkYXRhYmFzZSBjb25uZWN0aW9uXG5sZXQgdGVzdERhdGFTb3VyY2U6IERhdGFTb3VyY2U7XG5cbi8vIFNldHVwIGFuZCB0ZWFyZG93biBob29rc1xuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcbiAgLy8gSW5pdGlhbGl6ZSB0ZXN0IGRhdGFiYXNlIGNvbm5lY3Rpb24gaWYgbmVlZGVkXG4gIGlmIChwcm9jZXNzLmVudi5EQVRBQkFTRV9VUkwpIHtcbiAgICAvLyBEYXRhYmFzZSBzZXR1cCB3b3VsZCBnbyBoZXJlXG4gIH1cbn0pO1xuXG5hZnRlckFsbChhc3luYyAoKSA9PiB7XG4gIC8vIENsZWFudXAgdGVzdCBkYXRhYmFzZSBjb25uZWN0aW9uXG4gIGlmICh0ZXN0RGF0YVNvdXJjZSAmJiB0ZXN0RGF0YVNvdXJjZS5pc0luaXRpYWxpemVkKSB7XG4gICAgYXdhaXQgdGVzdERhdGFTb3VyY2UuZGVzdHJveSgpO1xuICB9XG59KTtcblxuYmVmb3JlRWFjaCgoKSA9PiB7XG4gIC8vIENsZWFyIGFsbCBtb2NrcyBiZWZvcmUgZWFjaCB0ZXN0XG4gIGplc3QuY2xlYXJBbGxNb2NrcygpO1xufSk7XG5cbmFmdGVyRWFjaCgoKSA9PiB7XG4gIC8vIEFkZGl0aW9uYWwgY2xlYW51cCBhZnRlciBlYWNoIHRlc3RcbiAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcbn0pO1xuXG4vLyBHbG9iYWwgdGVzdCB1dGlsaXRpZXNcbmRlY2xhcmUgZ2xvYmFsIHtcbiAgbmFtZXNwYWNlIGplc3Qge1xuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XG4gICAgICB0b0JlVmFsaWRVVUlEKCk6IFI7XG4gICAgICB0b0JlVmFsaWRFbWFpbCgpOiBSO1xuICAgICAgdG9CZVZhbGlkRGF0ZSgpOiBSO1xuICAgICAgdG9IYXZlVmFsaWRhdGlvbkVycm9yKGZpZWxkOiBzdHJpbmcpOiBSO1xuICAgICAgdG9NYXRjaEFwaVJlc3BvbnNlKCk6IFI7XG4gICAgfVxuICB9XG4gIFxuICB2YXIgdGVzdFV0aWxzOiB7XG4gICAgY3JlYXRlVGVzdGluZ01vZHVsZTogKG1ldGFkYXRhOiBhbnkpID0+IFByb21pc2U8VGVzdGluZ01vZHVsZT47XG4gICAgY3JlYXRlTW9ja1JlcG9zaXRvcnk6ICgpID0+IGFueTtcbiAgICBjcmVhdGVNb2NrU2VydmljZTogKG1ldGhvZHM6IHN0cmluZ1tdKSA9PiBhbnk7XG4gICAgZ2VuZXJhdGVUZXN0RGF0YTogKHR5cGU6IHN0cmluZywgb3ZlcnJpZGVzPzogYW55KSA9PiBhbnk7XG4gICAgY2xlYW51cERhdGFiYXNlOiAoKSA9PiBQcm9taXNlPHZvaWQ+O1xuICB9O1xufVxuXG4vLyBFeHBvcnQgdGVzdCB1dGlsaXRpZXNcbmdsb2JhbC50ZXN0VXRpbHMgPSB7XG4gIGNyZWF0ZVRlc3RpbmdNb2R1bGU6IGFzeW5jIChtZXRhZGF0YTogYW55KTogUHJvbWlzZTxUZXN0aW5nTW9kdWxlPiA9PiB7XG4gICAgY29uc3QgeyBUZXN0IH0gPSBhd2FpdCBpbXBvcnQoJ0BuZXN0anMvdGVzdGluZycpO1xuICAgIHJldHVybiBUZXN0LmNyZWF0ZVRlc3RpbmdNb2R1bGUobWV0YWRhdGEpLmNvbXBpbGUoKTtcbiAgfSxcblxuICBjcmVhdGVNb2NrUmVwb3NpdG9yeTogKCkgPT4gKHtcbiAgICBmaW5kOiBqZXN0LmZuKCksXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxuICAgIGZpbmRPbmVCeTogamVzdC5mbigpLFxuICAgIGZpbmRBbmRDb3VudDogamVzdC5mbigpLFxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxuICAgIHNhdmU6IGplc3QuZm4oKSxcbiAgICB1cGRhdGU6IGplc3QuZm4oKSxcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcbiAgICByZW1vdmU6IGplc3QuZm4oKSxcbiAgICBjb3VudDogamVzdC5mbigpLFxuICAgIGluY3JlbWVudDogamVzdC5mbigpLFxuICAgIGRlY3JlbWVudDogamVzdC5mbigpLFxuICAgIGNyZWF0ZVF1ZXJ5QnVpbGRlcjogamVzdC5mbigoKSA9PiAoe1xuICAgICAgd2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgYW5kV2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgb3JXaGVyZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBvcmRlckJ5OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGxpbWl0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIG9mZnNldDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIHRha2U6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgbGVmdEpvaW46IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgbGVmdEpvaW5BbmRTZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgaW5uZXJKb2luOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGlubmVySm9pbkFuZFNlbGVjdDogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXG4gICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgYWRkU2VsZWN0OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGdyb3VwQnk6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxuICAgICAgaGF2aW5nOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcbiAgICAgIGdldE9uZTogamVzdC5mbigpLFxuICAgICAgZ2V0TWFueTogamVzdC5mbigpLFxuICAgICAgZ2V0TWFueUFuZENvdW50OiBqZXN0LmZuKCksXG4gICAgICBnZXRDb3VudDogamVzdC5mbigpLFxuICAgICAgZ2V0UmF3T25lOiBqZXN0LmZuKCksXG4gICAgICBnZXRSYXdNYW55OiBqZXN0LmZuKCksXG4gICAgICBleGVjdXRlOiBqZXN0LmZuKCksXG4gICAgfSkpLFxuICB9KSxcblxuICBjcmVhdGVNb2NrU2VydmljZTogKG1ldGhvZHM6IHN0cmluZ1tdKSA9PiB7XG4gICAgY29uc3QgbW9ja1NlcnZpY2UgPSB7fTtcbiAgICBtZXRob2RzLmZvckVhY2gobWV0aG9kID0+IHtcbiAgICAgIG1vY2tTZXJ2aWNlW21ldGhvZF0gPSBqZXN0LmZuKCk7XG4gICAgfSk7XG4gICAgcmV0dXJuIG1vY2tTZXJ2aWNlO1xuICB9LFxuXG4gIGdlbmVyYXRlVGVzdERhdGE6ICh0eXBlOiBzdHJpbmcsIG92ZXJyaWRlczogYW55ID0ge30pID0+IHtcbiAgICAvLyBUaGlzIHdpbGwgYmUgaW1wbGVtZW50ZWQgd2l0aCBmYWN0b3JpZXNcbiAgICByZXR1cm4geyAuLi5vdmVycmlkZXMgfTtcbiAgfSxcblxuICBjbGVhbnVwRGF0YWJhc2U6IGFzeW5jICgpID0+IHtcbiAgICAvLyBEYXRhYmFzZSBjbGVhbnVwIGltcGxlbWVudGF0aW9uXG4gICAgaWYgKHRlc3REYXRhU291cmNlICYmIHRlc3REYXRhU291cmNlLmlzSW5pdGlhbGl6ZWQpIHtcbiAgICAgIC8vIENsZWFuIHVwIHRlc3QgZGF0YVxuICAgIH1cbiAgfSxcbn07XG5cbi8vIEVudmlyb25tZW50IHZhbGlkYXRpb25cbmlmICghcHJvY2Vzcy5lbnYuTk9ERV9FTlYpIHtcbiAgcHJvY2Vzcy5lbnYuTk9ERV9FTlYgPSAndGVzdCc7XG59XG5cbmlmIChwcm9jZXNzLmVudi5OT0RFX0VOViAhPT0gJ3Rlc3QnKSB7XG4gIHRocm93IG5ldyBFcnJvcignVGVzdHMgbXVzdCBiZSBydW4gd2l0aCBOT0RFX0VOVj10ZXN0Jyk7XG59XG4iXSwidmVyc2lvbiI6M30=