62fd3e478ea83bf0acc37ca192460a86
"use strict";
var __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    var desc = Object.getOwnPropertyDescriptor(m, k);
    if (!desc || ("get" in desc ? !m.__esModule : desc.writable || desc.configurable)) {
      desc = { enumerable: true, get: function() { return m[k]; } };
    }
    Object.defineProperty(o, k2, desc);
}) : (function(o, m, k, k2) {
    if (k2 === undefined) k2 = k;
    o[k2] = m[k];
}));
var __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {
    Object.defineProperty(o, "default", { enumerable: true, value: v });
}) : function(o, v) {
    o["default"] = v;
});
var __importStar = (this && this.__importStar) || (function () {
    var ownKeys = function(o) {
        ownKeys = Object.getOwnPropertyNames || function (o) {
            var ar = [];
            for (var k in o) if (Object.prototype.hasOwnProperty.call(o, k)) ar[ar.length] = k;
            return ar;
        };
        return ownKeys(o);
    };
    return function (mod) {
        if (mod && mod.__esModule) return mod;
        var result = {};
        if (mod != null) for (var k = ownKeys(mod), i = 0; i < k.length; i++) if (k[i] !== "default") __createBinding(result, mod, k[i]);
        __setModuleDefault(result, mod);
        return result;
    };
})();
Object.defineProperty(exports, "__esModule", { value: true });
// Mock external services by default
jest.mock('nodemailer', () => ({
    createTransport: jest.fn(() => ({
        sendMail: jest.fn().mockResolvedValue({ messageId: 'test-message-id' }),
        verify: jest.fn().mockResolvedValue(true),
    })),
}));
jest.mock('@aws-sdk/client-s3', () => ({
    S3Client: jest.fn(() => ({
        send: jest.fn(),
    })),
    PutObjectCommand: jest.fn(),
    GetObjectCommand: jest.fn(),
    DeleteObjectCommand: jest.fn(),
    HeadObjectCommand: jest.fn(),
}));
jest.mock('@aws-sdk/client-cloudfront', () => ({
    CloudFrontClient: jest.fn(() => ({
        send: jest.fn(),
    })),
    CreateInvalidationCommand: jest.fn(),
    GetDistributionCommand: jest.fn(),
}));
jest.mock('stripe', () => ({
    __esModule: true,
    default: jest.fn(() => ({
        customers: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        paymentIntents: {
            create: jest.fn(),
            retrieve: jest.fn(),
            confirm: jest.fn(),
            cancel: jest.fn(),
        },
        subscriptions: {
            create: jest.fn(),
            retrieve: jest.fn(),
            update: jest.fn(),
            del: jest.fn(),
        },
        webhooks: {
            constructEvent: jest.fn(),
        },
    })),
}));
require("reflect-metadata");
const dotenv_1 = require("dotenv");
// Load test environment variables
(0, dotenv_1.config)({ path: '.env.test' });
// Global test configuration
global.console = {
    ...console,
    // Suppress console.log in tests unless explicitly needed
    log: process.env.JEST_VERBOSE === 'true' ? console.log : jest.fn(),
    debug: process.env.JEST_VERBOSE === 'true' ? console.debug : jest.fn(),
    info: process.env.JEST_VERBOSE === 'true' ? console.info : jest.fn(),
    warn: console.warn,
    error: console.error,
};
// Global test timeout
jest.setTimeout(30000);
// Global test database connection
let testDataSource;
// Setup and teardown hooks
beforeAll(async () => {
    // Initialize test database connection if needed
    if (process.env.DATABASE_URL) {
        // Database setup would go here
    }
});
afterAll(async () => {
    // Cleanup test database connection
    if (testDataSource && testDataSource.isInitialized) {
        await testDataSource.destroy();
    }
});
beforeEach(() => {
    // Clear all mocks before each test
    jest.clearAllMocks();
});
afterEach(() => {
    // Additional cleanup after each test
    jest.restoreAllMocks();
});
// Export test utilities
global.testUtils = {
    createTestingModule: async (metadata) => {
        const { Test } = await Promise.resolve().then(() => __importStar(require('@nestjs/testing')));
        return Test.createTestingModule(metadata).compile();
    },
    createMockRepository: () => ({
        find: jest.fn(),
        findOne: jest.fn(),
        findOneBy: jest.fn(),
        findAndCount: jest.fn(),
        create: jest.fn(),
        save: jest.fn(),
        update: jest.fn(),
        delete: jest.fn(),
        remove: jest.fn(),
        count: jest.fn(),
        increment: jest.fn(),
        decrement: jest.fn(),
        createQueryBuilder: jest.fn(() => ({
            where: jest.fn().mockReturnThis(),
            andWhere: jest.fn().mockReturnThis(),
            orWhere: jest.fn().mockReturnThis(),
            orderBy: jest.fn().mockReturnThis(),
            limit: jest.fn().mockReturnThis(),
            offset: jest.fn().mockReturnThis(),
            skip: jest.fn().mockReturnThis(),
            take: jest.fn().mockReturnThis(),
            leftJoin: jest.fn().mockReturnThis(),
            leftJoinAndSelect: jest.fn().mockReturnThis(),
            innerJoin: jest.fn().mockReturnThis(),
            innerJoinAndSelect: jest.fn().mockReturnThis(),
            select: jest.fn().mockReturnThis(),
            addSelect: jest.fn().mockReturnThis(),
            groupBy: jest.fn().mockReturnThis(),
            having: jest.fn().mockReturnThis(),
            getOne: jest.fn(),
            getMany: jest.fn(),
            getManyAndCount: jest.fn(),
            getCount: jest.fn(),
            getRawOne: jest.fn(),
            getRawMany: jest.fn(),
            execute: jest.fn(),
        })),
    }),
    createMockService: (methods) => {
        const mockService = {};
        methods.forEach(method => {
            mockService[method] = jest.fn();
        });
        return mockService;
    },
    generateTestData: (type, overrides = {}) => {
        // This will be implemented with factories
        return { ...overrides };
    },
    cleanupDatabase: async () => {
        // Database cleanup implementation
        if (testDataSource && testDataSource.isInitialized) {
            // Clean up test data
        }
    },
};
// Environment validation
if (!process.env.NODE_ENV) {
    process.env.NODE_ENV = 'test';
}
if (process.env.NODE_ENV !== 'test') {
    throw new Error('Tests must be run with NODE_ENV=test');
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJmaWxlIjoiQzpcXFVzZXJzXFxIUFxcT25lRHJpdmVcXERlc2t0b3BcXG9ubHlkdXN0XFxTdHJlbGxlck1pbmRzLUJhY2tlbmRcXHRlc3RcXHNldHVwXFxqZXN0LnNldHVwLnRzIiwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O0FBc0JBLG9DQUFvQztBQUNwQyxJQUFJLENBQUMsSUFBSSxDQUFDLFlBQVksRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQzdCLGVBQWUsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDOUIsUUFBUSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUUsQ0FBQyxpQkFBaUIsQ0FBQyxFQUFFLFNBQVMsRUFBRSxpQkFBaUIsRUFBRSxDQUFDO1FBQ3ZFLE1BQU0sRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFLENBQUMsaUJBQWlCLENBQUMsSUFBSSxDQUFDO0tBQzFDLENBQUMsQ0FBQztDQUNKLENBQUMsQ0FBQyxDQUFDO0FBRUosSUFBSSxDQUFDLElBQUksQ0FBQyxvQkFBb0IsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO0lBQ3JDLFFBQVEsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDdkIsSUFBSSxFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7S0FDaEIsQ0FBQyxDQUFDO0lBQ0gsZ0JBQWdCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtJQUMzQixnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxFQUFFO0lBQzNCLG1CQUFtQixFQUFFLElBQUksQ0FBQyxFQUFFLEVBQUU7SUFDOUIsaUJBQWlCLEVBQUUsSUFBSSxDQUFDLEVBQUUsRUFBRTtDQUM3QixDQUFDLENBQUMsQ0FBQztBQUVKLElBQUksQ0FBQyxJQUFJLENBQUMsNEJBQTRCLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztJQUM3QyxnQkFBZ0IsRUFBRSxJQUFJLENBQUMsRUFBRSxDQUFDLEdBQUcsRUFB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QUNwQyxNQUFNLElBQUksS0FBSyxDQUFDLHNDQUFzQyxDQUFDLENBQUM7QUFDMUQsQ0FBQyIsIm5hbWVzIjpbXSwic291cmNlcyI6WyJDOlxcVXNlcnNcXEhQXFxPbmVEcml2ZVxcRGVza3RvcFxcb25seWR1c3RcXFN0cmVsbGVyTWluZHMtQmFja2VuZFxcdGVzdFxcc2V0dXBcXGplc3Quc2V0dXAudHMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0ICdyZWZsZWN0LW1ldGFkYXRhJztcclxuaW1wb3J0IHsgY29uZmlnIH0gZnJvbSAnZG90ZW52JztcclxuaW1wb3J0IHsgRGF0YVNvdXJjZSB9IGZyb20gJ3R5cGVvcm0nO1xyXG5pbXBvcnQgeyBUZXN0aW5nTW9kdWxlIH0gZnJvbSAnQG5lc3Rqcy90ZXN0aW5nJztcclxuXHJcbi8vIExvYWQgdGVzdCBlbnZpcm9ubWVudCB2YXJpYWJsZXNcclxuY29uZmlnKHsgcGF0aDogJy5lbnYudGVzdCcgfSk7XHJcblxyXG4vLyBHbG9iYWwgdGVzdCBjb25maWd1cmF0aW9uXHJcbmdsb2JhbC5jb25zb2xlID0ge1xyXG4gIC4uLmNvbnNvbGUsXHJcbiAgLy8gU3VwcHJlc3MgY29uc29sZS5sb2cgaW4gdGVzdHMgdW5sZXNzIGV4cGxpY2l0bHkgbmVlZGVkXHJcbiAgbG9nOiBwcm9jZXNzLmVudi5KRVNUX1ZFUkJPU0UgPT09ICd0cnVlJyA/IGNvbnNvbGUubG9nIDogamVzdC5mbigpLFxyXG4gIGRlYnVnOiBwcm9jZXNzLmVudi5KRVNUX1ZFUkJPU0UgPT09ICd0cnVlJyA/IGNvbnNvbGUuZGVidWcgOiBqZXN0LmZuKCksXHJcbiAgaW5mbzogcHJvY2Vzcy5lbnYuSkVTVF9WRVJCT1NFID09PSAndHJ1ZScgPyBjb25zb2xlLmluZm8gOiBqZXN0LmZuKCksXHJcbiAgd2FybjogY29uc29sZS53YXJuLFxyXG4gIGVycm9yOiBjb25zb2xlLmVycm9yLFxyXG59O1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgdGltZW91dFxyXG5qZXN0LnNldFRpbWVvdXQoMzAwMDApO1xyXG5cclxuLy8gTW9jayBleHRlcm5hbCBzZXJ2aWNlcyBieSBkZWZhdWx0XHJcbmplc3QubW9jaygnbm9kZW1haWxlcicsICgpID0+ICh7XHJcbiAgY3JlYXRlVHJhbnNwb3J0OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICBzZW5kTWFpbDogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHsgbWVzc2FnZUlkOiAndGVzdC1tZXNzYWdlLWlkJyB9KSxcclxuICAgIHZlcmlmeTogamVzdC5mbigpLm1vY2tSZXNvbHZlZFZhbHVlKHRydWUpLFxyXG4gIH0pKSxcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCdAYXdzLXNkay9jbGllbnQtczMnLCAoKSA9PiAoe1xyXG4gIFMzQ2xpZW50OiBqZXN0LmZuKCgpID0+ICh7XHJcbiAgICBzZW5kOiBqZXN0LmZuKCksXHJcbiAgfSkpLFxyXG4gIFB1dE9iamVjdENvbW1hbmQ6IGplc3QuZm4oKSxcclxuICBHZXRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXHJcbiAgRGVsZXRlT2JqZWN0Q29tbWFuZDogamVzdC5mbigpLFxyXG4gIEhlYWRPYmplY3RDb21tYW5kOiBqZXN0LmZuKCksXHJcbn0pKTtcclxuXHJcbmplc3QubW9jaygnQGF3cy1zZGsvY2xpZW50LWNsb3VkZnJvbnQnLCAoKSA9PiAoe1xyXG4gIENsb3VkRnJvbnRDbGllbnQ6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgIHNlbmQ6IGplc3QuZm4oKSxcclxuICB9KSksXHJcbiAgQ3JlYXRlSW52YWxpZGF0aW9uQ29tbWFuZDogamVzdC5mbigpLFxyXG4gIEdldERpc3RyaWJ1dGlvbkNvbW1hbmQ6IGplc3QuZm4oKSxcclxufSkpO1xyXG5cclxuamVzdC5tb2NrKCdzdHJpcGUnLCAoKSA9PiAoe1xyXG4gIF9fZXNNb2R1bGU6IHRydWUsXHJcbiAgZGVmYXVsdDogamVzdC5mbigoKSA9PiAoe1xyXG4gICAgY3VzdG9tZXJzOiB7XHJcbiAgICAgIGNyZWF0ZTogamVzdC5mbigpLFxyXG4gICAgICByZXRyaWV2ZTogamVzdC5mbigpLFxyXG4gICAgICB1cGRhdGU6IGplc3QuZm4oKSxcclxuICAgICAgZGVsOiBqZXN0LmZuKCksXHJcbiAgICB9LFxyXG4gICAgcGF5bWVudEludGVudHM6IHtcclxuICAgICAgY3JlYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgIHJldHJpZXZlOiBqZXN0LmZuKCksXHJcbiAgICAgIGNvbmZpcm06IGplc3QuZm4oKSxcclxuICAgICAgY2FuY2VsOiBqZXN0LmZuKCksXHJcbiAgICB9LFxyXG4gICAgc3Vic2NyaXB0aW9uczoge1xyXG4gICAgICBjcmVhdGU6IGplc3QuZm4oKSxcclxuICAgICAgcmV0cmlldmU6IGplc3QuZm4oKSxcclxuICAgICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICAgIGRlbDogamVzdC5mbigpLFxyXG4gICAgfSxcclxuICAgIHdlYmhvb2tzOiB7XHJcbiAgICAgIGNvbnN0cnVjdEV2ZW50OiBqZXN0LmZuKCksXHJcbiAgICB9LFxyXG4gIH0pKSxcclxufSkpO1xyXG5cclxuLy8gR2xvYmFsIHRlc3QgZGF0YWJhc2UgY29ubmVjdGlvblxyXG5sZXQgdGVzdERhdGFTb3VyY2U6IERhdGFTb3VyY2U7XHJcblxyXG4vLyBTZXR1cCBhbmQgdGVhcmRvd24gaG9va3NcclxuYmVmb3JlQWxsKGFzeW5jICgpID0+IHtcclxuICAvLyBJbml0aWFsaXplIHRlc3QgZGF0YWJhc2UgY29ubmVjdGlvbiBpZiBuZWVkZWRcclxuICBpZiAocHJvY2Vzcy5lbnYuREFUQUJBU0VfVVJMKSB7XHJcbiAgICAvLyBEYXRhYmFzZSBzZXR1cCB3b3VsZCBnbyBoZXJlXHJcbiAgfVxyXG59KTtcclxuXHJcbmFmdGVyQWxsKGFzeW5jICgpID0+IHtcclxuICAvLyBDbGVhbnVwIHRlc3QgZGF0YWJhc2UgY29ubmVjdGlvblxyXG4gIGlmICh0ZXN0RGF0YVNvdXJjZSAmJiB0ZXN0RGF0YVNvdXJjZS5pc0luaXRpYWxpemVkKSB7XHJcbiAgICBhd2FpdCB0ZXN0RGF0YVNvdXJjZS5kZXN0cm95KCk7XHJcbiAgfVxyXG59KTtcclxuXHJcbmJlZm9yZUVhY2goKCkgPT4ge1xyXG4gIC8vIENsZWFyIGFsbCBtb2NrcyBiZWZvcmUgZWFjaCB0ZXN0XHJcbiAgamVzdC5jbGVhckFsbE1vY2tzKCk7XHJcbn0pO1xyXG5cclxuYWZ0ZXJFYWNoKCgpID0+IHtcclxuICAvLyBBZGRpdGlvbmFsIGNsZWFudXAgYWZ0ZXIgZWFjaCB0ZXN0XHJcbiAgamVzdC5yZXN0b3JlQWxsTW9ja3MoKTtcclxufSk7XHJcblxyXG4vLyBHbG9iYWwgdGVzdCB1dGlsaXRpZXNcclxuZGVjbGFyZSBnbG9iYWwge1xyXG4gIG5hbWVzcGFjZSBqZXN0IHtcclxuICAgIGludGVyZmFjZSBNYXRjaGVyczxSPiB7XHJcbiAgICAgIHRvQmVWYWxpZFVVSUQoKTogUjtcclxuICAgICAgdG9CZVZhbGlkRW1haWwoKTogUjtcclxuICAgICAgdG9CZVZhbGlkRGF0ZSgpOiBSO1xyXG4gICAgICB0b0hhdmVWYWxpZGF0aW9uRXJyb3IoZmllbGQ6IHN0cmluZyk6IFI7XHJcbiAgICAgIHRvTWF0Y2hBcGlSZXNwb25zZSgpOiBSO1xyXG4gICAgfVxyXG4gIH1cclxuICBcclxuICB2YXIgdGVzdFV0aWxzOiB7XHJcbiAgICBjcmVhdGVUZXN0aW5nTW9kdWxlOiAobWV0YWRhdGE6IGFueSkgPT4gUHJvbWlzZTxUZXN0aW5nTW9kdWxlPjtcclxuICAgIGNyZWF0ZU1vY2tSZXBvc2l0b3J5OiAoKSA9PiBhbnk7XHJcbiAgICBjcmVhdGVNb2NrU2VydmljZTogKG1ldGhvZHM6IHN0cmluZ1tdKSA9PiBhbnk7XHJcbiAgICBnZW5lcmF0ZVRlc3REYXRhOiAodHlwZTogc3RyaW5nLCBvdmVycmlkZXM/OiBhbnkpID0+IGFueTtcclxuICAgIGNsZWFudXBEYXRhYmFzZTogKCkgPT4gUHJvbWlzZTx2b2lkPjtcclxuICB9O1xyXG59XHJcblxyXG4vLyBFeHBvcnQgdGVzdCB1dGlsaXRpZXNcclxuZ2xvYmFsLnRlc3RVdGlscyA9IHtcclxuICBjcmVhdGVUZXN0aW5nTW9kdWxlOiBhc3luYyAobWV0YWRhdGE6IGFueSk6IFByb21pc2U8VGVzdGluZ01vZHVsZT4gPT4ge1xyXG4gICAgY29uc3QgeyBUZXN0IH0gPSBhd2FpdCBpbXBvcnQoJ0BuZXN0anMvdGVzdGluZycpO1xyXG4gICAgcmV0dXJuIFRlc3QuY3JlYXRlVGVzdGluZ01vZHVsZShtZXRhZGF0YSkuY29tcGlsZSgpO1xyXG4gIH0sXHJcblxyXG4gIGNyZWF0ZU1vY2tSZXBvc2l0b3J5OiAoKSA9PiAoe1xyXG4gICAgZmluZDogamVzdC5mbigpLFxyXG4gICAgZmluZE9uZTogamVzdC5mbigpLFxyXG4gICAgZmluZE9uZUJ5OiBqZXN0LmZuKCksXHJcbiAgICBmaW5kQW5kQ291bnQ6IGplc3QuZm4oKSxcclxuICAgIGNyZWF0ZTogamVzdC5mbigpLFxyXG4gICAgc2F2ZTogamVzdC5mbigpLFxyXG4gICAgdXBkYXRlOiBqZXN0LmZuKCksXHJcbiAgICBkZWxldGU6IGplc3QuZm4oKSxcclxuICAgIHJlbW92ZTogamVzdC5mbigpLFxyXG4gICAgY291bnQ6IGplc3QuZm4oKSxcclxuICAgIGluY3JlbWVudDogamVzdC5mbigpLFxyXG4gICAgZGVjcmVtZW50OiBqZXN0LmZuKCksXHJcbiAgICBjcmVhdGVRdWVyeUJ1aWxkZXI6IGplc3QuZm4oKCkgPT4gKHtcclxuICAgICAgd2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBhbmRXaGVyZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIG9yV2hlcmU6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBvcmRlckJ5OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgbGltaXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBvZmZzZXQ6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBza2lwOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgdGFrZTogamVzdC5mbigpLm1vY2tSZXR1cm5UaGlzKCksXHJcbiAgICAgIGxlZnRKb2luOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgbGVmdEpvaW5BbmRTZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBpbm5lckpvaW46IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBpbm5lckpvaW5BbmRTZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBzZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBhZGRTZWxlY3Q6IGplc3QuZm4oKS5tb2NrUmV0dXJuVGhpcygpLFxyXG4gICAgICBncm91cEJ5OiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgaGF2aW5nOiBqZXN0LmZuKCkubW9ja1JldHVyblRoaXMoKSxcclxuICAgICAgZ2V0T25lOiBqZXN0LmZuKCksXHJcbiAgICAgIGdldE1hbnk6IGplc3QuZm4oKSxcclxuICAgICAgZ2V0TWFueUFuZENvdW50OiBqZXN0LmZuKCksXHJcbiAgICAgIGdldENvdW50OiBqZXN0LmZuKCksXHJcbiAgICAgIGdldFJhd09uZTogamVzdC5mbigpLFxyXG4gICAgICBnZXRSYXdNYW55OiBqZXN0LmZuKCksXHJcbiAgICAgIGV4ZWN1dGU6IGplc3QuZm4oKSxcclxuICAgIH0pKSxcclxuICB9KSxcclxuXHJcbiAgY3JlYXRlTW9ja1NlcnZpY2U6IChtZXRob2RzOiBzdHJpbmdbXSkgPT4ge1xyXG4gICAgY29uc3QgbW9ja1NlcnZpY2UgPSB7fTtcclxuICAgIG1ldGhvZHMuZm9yRWFjaChtZXRob2QgPT4ge1xyXG4gICAgICBtb2NrU2VydmljZVttZXRob2RdID0gamVzdC5mbigpO1xyXG4gICAgfSk7XHJcbiAgICByZXR1cm4gbW9ja1NlcnZpY2U7XHJcbiAgfSxcclxuXHJcbiAgZ2VuZXJhdGVUZXN0RGF0YTogKHR5cGU6IHN0cmluZywgb3ZlcnJpZGVzOiBhbnkgPSB7fSkgPT4ge1xyXG4gICAgLy8gVGhpcyB3aWxsIGJlIGltcGxlbWVudGVkIHdpdGggZmFjdG9yaWVzXHJcbiAgICByZXR1cm4geyAuLi5vdmVycmlkZXMgfTtcclxuICB9LFxyXG5cclxuICBjbGVhbnVwRGF0YWJhc2U6IGFzeW5jICgpID0+IHtcclxuICAgIC8vIERhdGFiYXNlIGNsZWFudXAgaW1wbGVtZW50YXRpb25cclxuICAgIGlmICh0ZXN0RGF0YVNvdXJjZSAmJiB0ZXN0RGF0YVNvdXJjZS5pc0luaXRpYWxpemVkKSB7XHJcbiAgICAgIC8vIENsZWFuIHVwIHRlc3QgZGF0YVxyXG4gICAgfVxyXG4gIH0sXHJcbn07XHJcblxyXG4vLyBFbnZpcm9ubWVudCB2YWxpZGF0aW9uXHJcbmlmICghcHJvY2Vzcy5lbnYuTk9ERV9FTlYpIHtcclxuICBwcm9jZXNzLmVudi5OT0RFX0VOViA9ICd0ZXN0JztcclxufVxyXG5cclxuaWYgKHByb2Nlc3MuZW52Lk5PREVfRU5WICE9PSAndGVzdCcpIHtcclxuICB0aHJvdyBuZXcgRXJyb3IoJ1Rlc3RzIG11c3QgYmUgcnVuIHdpdGggTk9ERV9FTlY9dGVzdCcpO1xyXG59XHJcbiJdLCJ2ZXJzaW9uIjozfQ==